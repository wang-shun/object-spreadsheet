<head>
  <script src="/jquery/jquery-1.11.1.min.js"></script>
  <script src="/handsontable/handsontable.full.js"></script>
  <script src="/codemirror/codemirror.js"></script>
  <link rel="stylesheet" type="text/css" href="/handsontable/handsontable.full.css">
  <link rel="stylesheet" type="text/css" href="/codemirror/codemirror.css">
</head>
<body>
</body>

<template name="Spreadsheet">
  <div id="ActionBar" class="{{actionBarClass}}">
    {{> formulaValueBar}}
  </div>
  <div id="ViewWrapper" class="{{actionBarClass}}">
    <!-- Handsontable requires an inline overflow style for fixed rows/columns to work. -->
    <!-- (see WalkontableOverlay.prototype.getScrollableElement) -->
    <div id="View" style="overflow: auto"></div>
  </div>
</template>

<template name="formulaValueBar">
  {{#if loading}}
    <div>Loading... This may take a minute, especially if the sheet is being filled with a sample data set.</div>
  {{/if}}
  {{#if fullTextToShow}}
    <div>{{fullTextToShow}}</div>
  {{/if}}
  {{#each addStateCellArgs}}
    {{> addStateCell}}
  {{/each}}
  {{#each changeColumnArgs}}
    {{> changeColumn}}
  {{/each}}
</template>

<template name="addStateCell">
  {{#if canAddValue}}
  <form>
    <label for="addStateCell-value">Add value:</label>
    <input id="addStateCell-value" type="text" name="value" size="40"/>
    <input type="submit" value="Add"/>
  </form>
  {{else}}
  {{#if canAddToken}}
  <form>
    <input type="submit" value="Add object"/>
  </form>
  {{else}}
  {{#if canAddUnit}}
  <form>
    <input type="submit" value="Add X"/>
  </form>
  {{/if}}
  {{/if}}
  {{/if}}
</template>

<template name="changeColumn">
  <form>
    <!-- hack to extend formula bar to fill the window and leave room -->
    <!-- for the buttons -->
    <table style="width: 100%">
      <tr>
      <td class="labelBox">
        {{columnName}}
        {{#unless isObject}}
        :: <input name="type" value="{{columnSpecifiedType}}" placeholder="{{columnType}}">
        {{/unless}}
      </td>
      {{#if isObject}}
        <td colspan="2"></td>
      {{else}}
        {{#if formula}}
        <th class="labelBox"><label for="changeFormula-formula">=</label></th>
        <td>
          <div id="changeFormula-formula" class="formula {{formulaClass}}" style="width: 100%; position: relative;">
            <!-- Spacebars docs: "However, an error is never thrown when trying to index into a non-object or an undefined value." -->
            {{#each newFormulaInfo.bands}}
              <div class="formulaBand {{#if selected}}formulaBandSelected{{/if}}"
                   style="left: {{left}}px; width: {{width}}px; top: {{top}}px; height: {{height}}px;"></div>
            {{/each}}
          </div>
        </td>
        {{else}}
        <td colspan="2"><button type="button" class="create">Create formula</button></td>
        {{/if}}
      {{/if}}
      <td class="buttonBox">
        <input type="submit" value="Save"/>
        <input type="reset" value="Revert"/>
      </td>
      </tr>
      <tr>
        {{#if isObject}}
          <td class="labelBox" colspan="3">Reference display format:
            <input id="changeColumn-referenceDisplay" type="text" name="referenceDisplay" placeholder="{{defaultReferenceDisplay}}"
                   class="referenceDisplay {{referenceDisplayClass}}"/></td>
        {{else}}
          <!-- I'm not sold on this feature, but keeping it until it causes a problem. ~ Matt 2015-10-06 -->
          <td class="labelBox" colspan="3">Display format:
            <input id="changeColumn-display" type="text" name="display" placeholder="(default)"
                   class="display {{displayClass}}"/></td>
        {{/if}}
      </tr>
      {{#if newFormulaInfo.selectedBand}}
      <tr>
        <td colspan="3">
          <div id="TracingView" style="height: 180px; overflow: auto;"></div>
        </td>
      </tr>
      {{/if}}
    </table>
  </form>
</template>
